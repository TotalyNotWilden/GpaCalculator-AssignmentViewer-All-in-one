javascript:(function(){function tE(){const l=document.getElementById("lblResultsFilterCaption");if(!l)return Promise.reject("No filter label");l.click();return new Promise((r,j)=>{const m=5e3,p=100;let w=0;const i=setInterval(()=>{const f=document.querySelector("iframe[src*='ResultFilters.aspx']");if(!f)return;let d;try{d=f.contentDocument||f.contentWindow.document}catch(e){return}const t=d.querySelector("#tabular"),b=d.querySelector("#btnSave");if(t&&b){clearInterval(i);t.checked=!0;b.click();r("Tabular view enabled")}w+=p;if(w>=m){clearInterval(i);j("Timeout waiting for tabular controls")}},p)})}if(document.getElementById("gpaPopup")){document.getElementById("gpaPopup").remove();document.getElementById("gpaOverlay")?.remove();return}tE().then(()=>setTimeout(()=>main(),1000)).catch(()=>main());function main(){javascript:(function(){if(document.getElementById("gpaPopup")){document.getElementById("gpaPopup").remove();document.getElementById("gpaOverlay")?.remove();return;}const e="dismissedAssignments";let d=JSON.parse(localStorage.getItem(e)||"[]"),u=[];function s(){localStorage.setItem(e,JSON.stringify(d));}let o=document.createElement("div");o.id="gpaOverlay";o.style="position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.15);z-index:9998;";let c=document.createElement("div");c.id="gpaPopup";c.style="position:fixed;top:10%;left:50%;transform:translateX(-50%);background:#fff;border:2px solid #333;padding:20px;border-radius:12px;box-shadow:0 5px 15px rgba(0,0,0,0.3);z-index:9999;font-family:sans-serif;max-width:600px;max-height:75vh;display:flex;flex-direction:column;";let h=document.createElement("div");h.style="display:flex;justify-content:flex-end;align-items:center;margin-bottom:12px;";let t=document.createElement("button");t.innerText="Switch to Assignments";t.style="padding:6px 12px;border:none;background:#555;color:#fff;border-radius:6px;cursor:pointer;";h.appendChild(t);c.appendChild(h);let g=document.createElement("div");g.style.height="75vh";g.style.overflowY="auto";g.style.flex="1 1 auto";let a=document.createElement("div");a.style.display="none";a.style.height="75vh";a.style.overflowY="auto";a.style.flex="1 1 auto";let table=document.createElement("table");table.style="width:100%;border-collapse:collapse;font-size:14px;table-layout:fixed;word-break:break-word;";table.innerHTML="<thead><tr><th style='text-align:left;padding:6px;border-bottom:2px solid #999;'>Class</th><th style='text-align:left;padding:6px;border-bottom:2px solid #999;'>Type</th><th style='text-align:left;padding:6px;border-bottom:2px solid #999;'>Name</th><th style='text-align:left;padding:6px;border-bottom:2px solid #999;'>Due Date</th><th style='text-align:left;padding:6px;border-bottom:2px solid #999;'>Status</th></tr></thead>";let tbody=document.createElement("tbody");table.appendChild(tbody);a.appendChild(table);let msg=document.createElement("p");msg.style.marginTop="10px";msg.textContent="Assignments arenâ€™t available.";a.appendChild(msg);let retry=document.createElement("button");retry.textContent="Retry Fetch";retry.style="margin-top:10px;padding:6px 12px;border:none;background:#007bff;color:#fff;border-radius:6px;cursor:pointer;display:none;";a.appendChild(retry);const url="https://gihs.daymap.net/daymap/student/assignments.aspx";function parse(t){const p=new DOMParser,n=p.parseFromString(t,"text/html"),r=[],f=new Set;return n.querySelectorAll("tr").forEach(tr=>{const td=tr.querySelectorAll("td");if(td.length>=10){let cls=td[2].innerText.trim(),typ=td[3].innerText.trim(),nam=td[4].innerText.trim(),due=td[6].innerText.trim(),stat=td[9].innerText.trim(),k=cls+"|"+typ+"|"+nam+"|"+due+"|"+stat;if(!f.has(k)){f.add(k);r.push({className:cls,type:typ,name:nam,dueDate:due,status:stat})}}}),r}function red(s){return!["Results have been published","Your work has been received","Your work has not been received"].includes(s)}function render(list){tbody.innerHTML="";if(list.length===0){msg.style.display="block";return}msg.style.display="none";let redItems=[],others=[];list.forEach(x=>{if(d.includes(x.className+"|"+x.type+"|"+x.name+"|"+x.dueDate+"|"+x.status))return;if(red(x.status))redItems.push(x);else others.push(x)});[...redItems,...others].forEach(x=>{let r=document.createElement("tr"),bs="padding:6px;border-bottom:1px solid #eee;word-break:break-word;",rs=red(x.status)?"color:red;":"";r.innerHTML=%60<td style="${bs}">${x.className}</td><td style="${bs}">${x.type}</td><td style="${bs}">${x.name}</td><td style="${bs}">${x.dueDate}</td><td style="${bs}${rs}">${x.status}</td>%60;if(red(x.status)){r.style.cursor="pointer";r.title="Click to dismiss assignment (Ctrl+Z to undo)";r.addEventListener("click",()=>{d.push(x.className+"|"+x.type+"|"+x.name+"|"+x.dueDate+"|"+x.status);s();u.push({action:"dismiss",data:x});render(assignments)})}tbody.appendChild(r)})}function fetchAssign(){retry.style.display="none";tbody.innerHTML="";msg.textContent="Loading assignments...";msg.style.display="block";fetch(url,{credentials:"include"}).then(r=>{if(!r.ok)throw new Error("Network response was not ok");return r.text()}).then(t=>{assignments=parse(t);if(assignments.length===0){msg.textContent="No assignments found.";msg.style.display="block"}else{msg.style.display="none";render(assignments)}}).catch(e=>{msg.textContent="Failed to fetch assignments. Please try again.";retry.style.display="inline-block";console.error(e)})}retry.onclick=fetchAssign;let assignments=[];if(location.pathname.toLowerCase().includes("/student/assignments.aspx")){let a=[],seen=new Set;document.querySelectorAll("table tr").forEach(tr=>{let td=tr.querySelectorAll("td");if(td.length>=10){let c=td[2].innerText.trim(),t=td[3].innerText.trim(),n=td[4].innerText.trim(),du=td[6].innerText.trim(),st=td[9].innerText.trim(),k=c+"|"+t+"|"+n+"|"+du+"|"+st;if(!seen.has(k)){seen.add(k);a.push({className:c,type:t,name:n,dueDate:du,status:st})}}});if(a.length===0){msg.style.display="block"}else{msg.style.display="none";render(a);assignments=a}}else fetchAssign();t.onclick=()=>{if(g.style.display!=="none"){g.style.display="none";a.style.display="block";t.innerText="Switch to GPA"}else{g.style.display="block";a.style.display="none";t.innerText="Switch to Assignments"}};c.appendChild(g);c.appendChild(a);o.onclick=()=>{c.remove();o.remove()};c.onclick=e=>e.stopPropagation();document.body.appendChild(o);document.body.appendChild(c);let sel=document.createElement("select");sel.style="margin-bottom:12px;padding:4px;font-size:14px;border-radius:6px;";["15-point","5-point","4-point","Percentage","Letter"].forEach(v=>{let o=document.createElement("option");o.value=v;o.textContent=v;sel.appendChild(o)});g.appendChild(sel);let table2=document.createElement("table");table2.style="width:100%;border-collapse:collapse;font-size:14px;table-layout:fixed;";let thead=document.createElement("thead");thead.innerHTML="<tr><th style='text-align:left;padding:6px;border-bottom:2px solid #999;'>Subject</th><th style='text-align:left;padding:6px;border-bottom:2px solid #999;'>Grades</th><th style='text-align:right;padding:6px;border-bottom:2px solid #999;'>GPA</th></tr>";table2.appendChild(thead);let tbody2=document.createElement("tbody");let map={'GPA for 7CH DA:':"Chinese:",'GPA for 7ENGR ED:':"English:",'GPA for 7FDT 1A:':"Food And Digitech:",'GPA for 7HPE 1G:':"HPE:",'GPA for 7HUMR ED:':"Humanities:",'GPA for 7MATR ED:':"Math:",'GPA for 7SCIR ED:':"Science:"};let txt="Subject,Grades,GPA\n",scores=[],pending=[],all=document.body.getElementsByTagName("*");function makeSpans(g){let l=[];for(let j=0;j<g.length;j+=3){let s=g.slice(j,j+3).map(x=>%60<span style='display:inline-block;min-width:24px;text-align:left;margin-right:6px;font-weight:normal;'>${x}</span>%60).join("");l.push(s)}return l.join("<br>")}function convert(g,v){if(v==="15-point")return%60${g.toFixed(2)} / 15%60;if(v==="5-point")return%60${(g/15*5).toFixed(2)} / 5%60;if(v==="4-point")return%60${(g/15*4).toFixed(2)} / 4%60;if(v==="Percentage")return%60${(g/15*100).toFixed(1)}%%60;if(v==="Letter"){let l="F";if(g>=14.5)l="A+";else if(g>=13.5)l="A";else if(g>=12.5)l="A-";else if(g>=11.5)l="B+";else if(g>=10.5)l="B";else if(g>=9.5)l="B-";else if(g>=8.5)l="C+";else if(g>=7.5)l="C";else if(g>=6.5)l="C-";else if(g>=5.5)l="D+";else if(g>=4.5)l="D";return l}return g.toFixed(2)}for(let i=0;i<all.length;i++){let el=all[i];if(el.tagName==="B"&&/GPA for/.test(el.innerText)){let m=el.innerText.trim().match(/(.+?)\s+(\d+(\.\d+)?)\s*$/);if(m){let sub=m[1].trim();if(map[sub])sub=map[sub];let g=parseFloat(m[2]);if(g>=0&&g<=15){let h=makeSpans(pending);let csp=pending.join(" | ");pending=[];scores.push(g);txt+=%60${sub},"${csp}",${g.toFixed(2)}\n%60;let col=g>=14.5?"#4caf50":g>=12?"#ffc107":"#f44336";let r=document.createElement("tr");r.dataset.gpa=g;r.innerHTML=%60<td style='padding:6px;border-bottom:1px solid #eee;'>${sub}</td><td style='padding:6px;border-bottom:1px solid #eee;'>${h}</td><td class='gpaCell' style='padding:6px;text-align:right;border-bottom:1px solid #eee;color:${col};font-weight:bold;'>${convert(g,sel.value)}</td>%60;tbody2.appendChild(r)}}}else if(el.tagName==="TD"){let val=el.innerText.trim();if(/^[ABCDF][+-]?$/.test(val))pending.push(val)}}table2.appendChild(tbody2);g.appendChild(table2);let avg=scores.length>0?scores.reduce((a,b)=>a+b,0)/scores.length:null;let avgSpan=document.createElement("div");avgSpan.style="margin-top:15px;font-weight:bold;text-align:right;font-size:15px;";g.appendChild(avgSpan);function update(){if(avg===null){avgSpan.innerText="No GPA data found."}else{let v=sel.value;avgSpan.innerText="Average GPA: "+convert(avg,v);tbody2.querySelectorAll("tr").forEach(r=>{let g=parseFloat(r.dataset.gpa),cell=r.querySelector(".gpaCell");if(cell)cell.innerText=convert(g,v)})}}sel.onchange=update;update();let b=document.createElement("button");b.innerText="Copy CSV";b.style="margin-top:10px;margin-right:10px;padding:6px 12px;border:none;background:#007bff;color:white;border-radius:6px;cursor:pointer;";b.onclick=()=>{navigator.clipboard.writeText(txt).then(()=>{b.innerText="Copied!";setTimeout(()=>b.innerText="Copy CSV",1500)})};g.appendChild(b);let x=document.createElement("button");x.innerText="Close";x.style="margin-top:10px;padding:6px 12px;border:none;background:#333;color:#fff;border-radius:6px;cursor:pointer;";x.onclick=()=>{c.remove();o.remove()};g.appendChild(x);document.addEventListener("keydown",k=>{if((k.ctrlKey||k.metaKey)&&k.key.toLowerCase()==="z"&&u.length>0){k.preventDefault();let l=u.pop();if(l.action==="dismiss"){let key=l.data.className+"|"+l.data.type+"|"+l.data.name+"|"+l.data.dueDate+"|"+l.data.status;d=d.filter(dd=>dd!==key);s();render(assignments)}}})})();}})();
